# å¯¼å¼¹ä»¿çœŸDLLé¡¹ç›® - ä»£ç åˆ†ææŠ¥å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2026-02-26
**ç‰ˆæœ¬**: v2.0 (æ›´æ–°ç‰ˆ)
**åˆ†æèŒƒå›´**: MissileDll_Template å…¨é¡¹ç›®æºä»£ç 

---

## é—®é¢˜æ¦‚è¿°

æœ¬æ¬¡ä»£ç å®¡æŸ¥å…±å‘ç° **4ä¸ªå·²ä¿®å¤é—®é¢˜**ã€**4ä¸ªæ–°å‘ç°é—®é¢˜** å’Œ **1ä¸ªä¹±ç é—®é¢˜**ã€‚

| çŠ¶æ€ | é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ |
|------|------|----------|
| âœ… å·²ä¿®å¤ | whileæ­»å¾ªç¯ | ğŸ”´ ä¸¥é‡ |
| âœ… å·²ä¿®å¤ | AssignMissileç©ºæŒ‡é’ˆæ£€æŸ¥é€»è¾‘é”™è¯¯ | ğŸ”´ ä¸¥é‡ |
| âœ… å·²ä¿®å¤ | GetMissileState_Cæœªå®ç° | ğŸ”´ ä¸¥é‡ |
| âœ… å·²ä¿®å¤ | å‘½åç©ºé—´æ³¨é‡Šä¸ä¸€è‡´ | ğŸŸ¡ è½»å¾® |
| ğŸ”´ æ–°å‘ç° | å…¨å±€å˜é‡åœ¨mainå‰åˆå§‹åŒ–DLLå¯¹è±¡ | ğŸ”´ ä¸¥é‡ |
| ğŸ”´ æ–°å‘ç° | å†…å­˜æ³„æ¼(singleMissile2) | ğŸ”´ ä¸¥é‡ |
| ğŸ”´ æ–°å‘ç° | æ—¶é—´ç´¯åŠ é€»è¾‘é”™è¯¯ | ğŸ”´ ä¸¥é‡ |
| ğŸ”´ æ–°å‘ç° | getStateæœªè®¾ç½®è¾“å‡ºå€¼ | ğŸ”´ ä¸¥é‡ |
| ğŸ”´ æ–°å‘ç° | æ§åˆ¶å°ä¸­æ–‡ä¹±ç  | ğŸ”´ ä¸¥é‡ |

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜å›é¡¾

### ä¿®å¤1: whileæ­»å¾ªç¯
**æ–‡ä»¶**: `main/æº.cpp:56`
```cpp
if (outParams.time > 10) {
    std::cout << u8"ä»¿çœŸç»“æŸ" << std::endl;
    break;  // âœ… å·²æ·»åŠ break
}
```

### ä¿®å¤2: AssignMissileç©ºæŒ‡é’ˆæ£€æŸ¥
**æ–‡ä»¶**: `Missile_Dll/MissileSim.cpp:27`
```cpp
if (targetmissile == nullptr || sourcemissile == nullptr)  // âœ… å·²ä¿®å¤
{
    return;
}
```

### ä¿®å¤3: GetMissileState_Cå‡½æ•°
**æ–‡ä»¶**: `Missile_Dll/MissileSim.cpp`
- è¯¥å‡½æ•°å·²è¢«åˆ é™¤

### ä¿®å¤4: å‘½åç©ºé—´æ³¨é‡Š
**æ–‡ä»¶**: `Missile_Dll/MissileSim.h:63`
```cpp
} // namespace XXX_MissileSim  // âœ… å·²ä¿®æ­£
```

---

## ğŸ”´ æ–°å‘ç°çš„é—®é¢˜ï¼ˆæœ¬æ¬¡ä¿®å¤ï¼‰

### é—®é¢˜1: å…¨å±€å˜é‡åœ¨mainå‰åˆå§‹åŒ–DLLå¯¹è±¡

**æ–‡ä»¶**: `main/æº.cpp`
**åŸä»£ç è¡Œå·**: 16-18

#### é—®é¢˜åˆ†æ

```cpp
// âŒ åŸä»£ç ï¼šå…¨å±€å˜é‡åœ¨main()ä¹‹å‰æ‰§è¡Œ
void* singleMissile1 = CreateMissile();
void* singleMissile2 = CopyMissile(singleMissile1);
void* singleMissile3 = CreateMissile();

int main() {
    SingleSim();  // singleMissile1/2/3åœ¨è¿™é‡Œè¢«ä½¿ç”¨
}
```

**é”™è¯¯åŸå› **:
- å…¨å±€å˜é‡åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼ˆ`main`ä¹‹å‰ï¼‰åˆå§‹åŒ–
- æ­¤æ—¶DLLå¯èƒ½è¿˜æœªå®Œå…¨åŠ è½½/åˆå§‹åŒ–
- `singleMissile2` ä½¿ç”¨ `singleMissile1` è¿›è¡Œæ‹·è´ï¼Œä½†**è·¨ç¼–è¯‘å•å…ƒçš„å…¨å±€å˜é‡åˆå§‹åŒ–é¡ºåºæ˜¯æœªå®šä¹‰çš„**
- å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æœªå®šä¹‰è¡Œä¸º

#### ä¿®å¤æ–¹æ¡ˆ

```cpp
// âœ… ä¿®å¤åï¼šåœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºå¯¹è±¡
int main() {
    // è®¾ç½®æ§åˆ¶å°ä¸ºUTF-8ç¼–ç ï¼ˆè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼‰
    SetConsoleOutputCP(CP_UTF8);

    SingleSim();
    return 0;
}

void SingleSim() {
    // åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºå¯¼å¼¹å¯¹è±¡ï¼ˆé¿å…å…¨å±€å˜é‡åˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼‰
    void* singleMissile1 = CreateMissile();
    void* singleMissile2 = CopyMissile(singleMissile1);
    void* singleMissile3 = CreateMissile();
    // ...
}
```

---

### é—®é¢˜2: å†…å­˜æ³„æ¼ (singleMissile2)

**æ–‡ä»¶**: `main/æº.cpp`
**åŸä»£ç è¡Œå·**: 60-61

#### é—®é¢˜åˆ†æ

```cpp
// âŒ åŸä»£ç ï¼šsingleMissile2ä»æœªé”€æ¯
XXX_MissileSim::DestroyMissile(singleMissile1);
XXX_MissileSim::DestroyMissile(singleMissile3);
// singleMissile2 å†…å­˜æ³„æ¼ï¼
```

#### ä¿®å¤æ–¹æ¡ˆ

```cpp
// âœ… ä¿®å¤åï¼šé”€æ¯æ‰€æœ‰å¯¹è±¡
XXX_MissileSim::DestroyMissile(singleMissile1);
XXX_MissileSim::DestroyMissile(singleMissile2);  // æ·»åŠ æ­¤è¡Œ
XXX_MissileSim::DestroyMissile(singleMissile3);
```

---

### é—®é¢˜3: æ—¶é—´ç´¯åŠ é€»è¾‘é”™è¯¯

**æ–‡ä»¶**: `main/æº.cpp`
**åŸä»£ç è¡Œå·**: 52

#### é—®é¢˜åˆ†æ

```cpp
// âŒ åŸä»£ç ï¼šæ—¶é—´è¢«ç´¯åŠ ä¸¤æ¬¡
while (true) {
    XXX_MissileSim::UpdateMissile(singleMissile1, &updateParams);  // å†…éƒ¨time += step
    XXX_MissileSim::GetMissileState(singleMissile1, &outParams);
    outParams.time += updateParams.step;  // âŒ åˆåŠ äº†ä¸€æ¬¡ï¼
    if (outParams.time > 10) { ... }
}
```

**é—®é¢˜**:
- `UpdateMissile` å†…éƒ¨å·²ç»æ›´æ–°äº† `time`
- å¤–éƒ¨åˆæ‰‹åŠ¨ `+= step`
- ç»“æœï¼šæ—¶é—´å®é™…æ­¥è¿›æ˜¯ `2 * step`ï¼ˆæ¯æ¬¡0.2ç§’è€Œé0.1ç§’ï¼‰

#### ä¿®å¤æ–¹æ¡ˆ

```cpp
// âœ… ä¿®å¤åï¼šåªåœ¨å†…å±‚ç´¯åŠ æ—¶é—´
while (true) {
    XXX_MissileSim::UpdateMissile(singleMissile1, &updateParams);
    XXX_MissileSim::GetMissileState(singleMissile1, &outParams);
    // åˆ é™¤æ‰‹åŠ¨ç´¯åŠ çš„ä»£ç 
    if (outParams.time > 10) { ... }
}
```

**åŒæ—¶ä¿®å¤ `MissileCore.cpp` ä¸­çš„updateå‡½æ•°**:
```cpp
// âœ… ä¿®å¤åï¼šç´¯åŠ æ—¶é—´æ­¥é•¿
void MissileCore::update(const XXX_MissileSim::UpdateParams& update) {
    time += update.step;  // æ”¹ä¸ºç´¯åŠ è€Œéç›´æ¥èµ‹å€¼
    // ...
}
```

---

### é—®é¢˜4: getStateæœªè®¾ç½®è¾“å‡ºå€¼

**æ–‡ä»¶**: `Missile_Dll/MissileCore.cpp`
**åŸä»£ç è¡Œå·**: 134-145

#### é—®é¢˜åˆ†æ

```cpp
// âŒ åŸä»£ç ï¼šæ‰€æœ‰è¾“å‡ºéƒ½è¢«æ³¨é‡Š
void MissileCore::getState(XXX_MissileSim::OutputParams& out) const {
    //out.time = 0.0;
    //out.LLA[0] = 0.0;
    //out.LLA[1] = 0.0;
    //out.LLA[2] = 0.0;
    //out.Vn[0] = 0.0;
    //out.Vn[1] = 0.0;
    //out.Vn[2] = 0.0;
    out.flag_ko = false;  // åªè®¾ç½®äº†è¿™ä¸€ä¸ª
}
```

**é—®é¢˜**: `GetMissileState` è¿”å›çš„æ˜¯æœªåˆå§‹åŒ–çš„åƒåœ¾å€¼ï¼ˆé™¤ `flag_ko` å¤–ï¼‰

#### ä¿®å¤æ–¹æ¡ˆ

```cpp
// âœ… ä¿®å¤åï¼šæ­£ç¡®è®¾ç½®æ‰€æœ‰è¾“å‡º
void MissileCore::getState(XXX_MissileSim::OutputParams& out) const {
    out.id = id;
    out.time = time;
    out.LLA[0] = Lm;
    out.LLA[1] = Bm;
    out.LLA[2] = Hm;
    out.Vn[0] = Vx_n;
    out.Vn[1] = Vy_n;
    out.Vn[2] = Vz_n;
    out.flag_ko = false;
}
```

**åŒæ—¶ä¿®å¤ `MissileCore` æ„é€ å‡½æ•°**ï¼ˆåˆå§‹åŒ–æˆå‘˜å˜é‡ï¼‰:
```cpp
// âœ… æ·»åŠ æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨
MissileCore::MissileCore()
    : id(0), time(0.0), Time_system(0.0)
    , Lm(0.0), Bm(0.0), Hm(0.0)
    , Vx_n(0.0), Vy_n(0.0), Vz_n(0.0)
{
    mp = new SubModels;
}
```

**åŒæ—¶ä¿®å¤ `initialize` å‡½æ•°**ï¼ˆä»InitParamsè¯»å–å€¼ï¼‰:
```cpp
// âœ… æ­£ç¡®åˆå§‹åŒ–æ‰€æœ‰å‚æ•°
void MissileCore::initialize(const XXX_MissileSim::InitParams& initial) {
    id = initial.id;
    time = initial.time;
    Lm = initial.Lm0;
    Bm = initial.Bm0;
    Hm = initial.Hm0;
    Vx_n = initial.Vx_n0;
    Vy_n = initial.Vy_n0;
    Vz_n = initial.Vz_n0;
    // ...
}
```

---

### é—®é¢˜5: æ§åˆ¶å°ä¸­æ–‡ä¹±ç 

**æ–‡ä»¶**: `main/æº.cpp`

#### é—®é¢˜åˆ†æ

Windowsæ§åˆ¶å°é»˜è®¤ä½¿ç”¨ç³»ç»Ÿç¼–ç ï¼ˆä¸­æ–‡Windowsé€šå¸¸æ˜¯GBK/CP936ï¼‰ï¼Œè€Œæºä»£ç ä½¿ç”¨UTF-8ç¼–ç å’Œ `u8"..."` å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå¯¼è‡´æ˜¾ç¤ºä¹±ç ï¼š

```
Guide æ„é€ å®Œæˆ
[Aero] æ°”åŠ¨è®¡ç®—...
 Missile 1 - æµ¼ä½·ç´¶éƒå •æ£¿:0.1  ...
```

#### ä¿®å¤æ–¹æ¡ˆ

åœ¨ `main()` å‡½æ•°å¼€å¤´è®¾ç½®æ§åˆ¶å°è¾“å‡ºç¼–ç ä¸ºUTF-8ï¼š

```cpp
#include <windows.h>  // æ·»åŠ æ­¤å¤´æ–‡ä»¶

int main() {
    // è®¾ç½®æ§åˆ¶å°ä¸ºUTF-8ç¼–ç ï¼ˆè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼‰
    SetConsoleOutputCP(CP_UTF8);

    SingleSim();
    return 0;
}
```

**æ³¨æ„**: éœ€è¦ç¡®ä¿æ§åˆ¶å°å­—ä½“æ”¯æŒUTF-8æ˜¾ç¤ºï¼ˆWindows 10/11é»˜è®¤å­—ä½“å·²æ”¯æŒï¼‰

---

## ä¿®å¤æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `main/æº.cpp` | 1. æ·»åŠ  `#include <windows.h>`<br>2. æ·»åŠ  `SetConsoleOutputCP(CP_UTF8)`<br>3. åˆ é™¤å…¨å±€å˜é‡ï¼Œåœ¨å‡½æ•°å†…åˆ›å»º<br>4. åˆ é™¤æ‰‹åŠ¨æ—¶é—´ç´¯åŠ <br>5. æ·»åŠ  `singleMissile2` çš„é”€æ¯ |
| `Missile_Dll/MissileCore.cpp` | 1. æ„é€ å‡½æ•°æ·»åŠ æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨<br>2. `initialize` æ­£ç¡®è¯»å–InitParams<br>3. `update` æ”¹ä¸ºç´¯åŠ æ—¶é—´<br>4. `getState` æ­£ç¡®è®¾ç½®æ‰€æœ‰è¾“å‡º |

### ä¿®å¤åçš„ä»£ç ç‰‡æ®µ

#### main/æº.cpp (å…³é”®éƒ¨åˆ†)

```cpp
#include <windows.h>  // ç”¨äºè®¾ç½®æ§åˆ¶å°ç¼–ç 

int main() {
    // è®¾ç½®æ§åˆ¶å°ä¸ºUTF-8ç¼–ç ï¼ˆè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼‰
    SetConsoleOutputCP(CP_UTF8);

    SingleSim();
    return 0;
}

void SingleSim() {
    // åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºå¯¼å¼¹å¯¹è±¡ï¼ˆé¿å…å…¨å±€å˜é‡åˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼‰
    void* singleMissile1 = CreateMissile();
    void* singleMissile2 = CopyMissile(singleMissile1);
    void* singleMissile3 = CreateMissile();

    AssignMissile(singleMissile3, singleMissile1);

    XXX_MissileSim::InitParams initParams = { 1,0,100,30,10.e3,400,0,0};
    XXX_MissileSim::InitializeMissile(singleMissile1, &initParams);

    XXX_MissileSim::UpdateParams updateParams = { 0.1,0.0,100,40,10e3,-300,0,0 };
    XXX_MissileSim::OutputParams outParams = {};

    std::cout << u8"=== å•å¼¹ä»¿çœŸå¼€å§‹ ===\n";

    while (true) {
        XXX_MissileSim::UpdateMissile(singleMissile1, &updateParams);
        XXX_MissileSim::GetMissileState(singleMissile1, &outParams);

        std::cout << u8"å¯¼å¼¹ç¼–å·:" << outParams.id
                  << u8" ä»¿çœŸæ—¶é—´:" << outParams.time
                  << u8" å¯¼å¼¹é«˜åº¦:" << outParams.LLA[2] << std::endl;

        if (outParams.time > 10) {
            std::cout << u8"ä»¿çœŸç»“æŸ" << std::endl;
            break;
        }
    }

    // æ‘§æ¯æ‰€æœ‰å¯¹è±¡ï¼ˆåŒ…æ‹¬singleMissile2ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼‰
    XXX_MissileSim::DestroyMissile(singleMissile1);
    XXX_MissileSim::DestroyMissile(singleMissile2);
    XXX_MissileSim::DestroyMissile(singleMissile3);
}
```

#### Missile_Dll/MissileCore.cpp (å…³é”®éƒ¨åˆ†)

```cpp
// æ„é€ å‡½æ•° - æ·»åŠ æˆå‘˜åˆå§‹åŒ–
MissileCore::MissileCore()
    : id(0), time(0.0), Time_system(0.0)
    , Lm(0.0), Bm(0.0), Hm(0.0)
    , Vx_n(0.0), Vy_n(0.0), Vz_n(0.0)
{
    mp = new SubModels;
}

// åˆå§‹åŒ–å‡½æ•° - æ­£ç¡®è¯»å–InitParams
void MissileCore::initialize(const XXX_MissileSim::InitParams& initial) {
    id = initial.id;
    time = initial.time;
    Lm = initial.Lm0;
    Bm = initial.Bm0;
    Hm = initial.Hm0;
    Vx_n = initial.Vx_n0;
    Vy_n = initial.Vy_n0;
    Vz_n = initial.Vz_n0;
    // ...
}

// æ›´æ–°å‡½æ•° - ç´¯åŠ æ—¶é—´
void MissileCore::update(const XXX_MissileSim::UpdateParams& update) {
    time += update.step;  // ç´¯åŠ æ—¶é—´æ­¥é•¿
    // ...
}

// è·å–çŠ¶æ€ - æ­£ç¡®è®¾ç½®æ‰€æœ‰è¾“å‡º
void MissileCore::getState(XXX_MissileSim::OutputParams& out) const {
    out.id = id;
    out.time = time;
    out.LLA[0] = Lm;
    out.LLA[1] = Bm;
    out.LLA[2] = Hm;
    out.Vn[0] = Vx_n;
    out.Vn[1] = Vy_n;
    out.Vn[2] = Vz_n;
    out.flag_ko = false;
}
```

---

## éªŒè¯å»ºè®®

ä¿®å¤åï¼Œç¨‹åºåº”è¯¥è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼ˆæ— ä¹±ç ï¼‰ï¼š

```
Guide æ„é€ å®Œæˆ
=== å•å¼¹ä»¿çœŸå¼€å§‹ ===
å¯¼å¼¹ç¼–å·:1 ä»¿çœŸæ—¶é—´:0.1 å¯¼å¼¹é«˜åº¦:10000
å¯¼å¼¹ç¼–å·:1 ä»¿çœŸæ—¶é—´:0.2 å¯¼å¼¹é«˜åº¦:10000
...
å¯¼å¼¹ç¼–å·:1 ä»¿çœŸæ—¶é—´:10.1 å¯¼å¼¹é«˜åº¦:10000
ä»¿çœŸç»“æŸ
MissileCore ææ„å®Œæˆã€‚
MissileCore ææ„å®Œæˆã€‚
MissileCore ææ„å®Œæˆã€‚
```

---

**æŠ¥å‘Šç»“æŸ**
